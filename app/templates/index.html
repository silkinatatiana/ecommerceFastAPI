{% extends "base.html" %}

{% block title %}{{ shop_name }} - Главная{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='/styles/main.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', path='/styles/product/product_card.css') }}?v=1.0">
{% endblock %}

{% block content %}
<div class="main-content-wrapper">
    <div class="filters-sidebar">
        <div class="filter-block">
            <h3>Категории</h3>
            <div class="filter-options">
                {% for category_name, category_data in categories_products.items() %}
                <label class="filter-checkbox">
                    <input type="checkbox"
                           name="category"
                           value="{{ category_data.id }}"
                           {% if current_category == category_data.id %}checked{% endif %}
                           onchange="applyFilters()">
                    <span>{{ category_name | title }}</span>
                </label>
                {% endfor %}
            </div>
        </div>

        {% if is_authenticated %}
        <div class="filter-block" id="favoritesFilter">
            <h3>Избранное</h3>
            <label class="filter-checkbox">
                <input type="checkbox"
                       id="favoritesOnlyCheckbox"
                       name="is_favorite"
                       {% if is_favorite %}checked{% endif %}
                       onchange="applyFilters()">
                <span>Избранное</span>
            </label>
        </div>
        {% endif %}

        <div class="filter-block">
            <h3>Объем встроенной памяти</h3>
            <div class="filter-options">
                {% for memory in all_built_in_memory %}
                <label class="filter-checkbox">
                    <input type="checkbox"
                            name="built_in_memory"
                            value="{{ memory }}"
                            {% if memory in selected_built_in_memory %}checked{% endif %}
                            onchange="applyFilters()">
                    <span>{{ memory }}</span>
                </label>
                {% endfor %}
            </div>
        </div>

        <div class="filter-block">
            <h3>Цвета</h3>
            <div class="filter-options">
                {% for color in colors %}
                <label class="filter-checkbox">
                    <input type="checkbox"
                           name="color"
                           value="{{ color }}"
                           onchange="applyFilters()">
                    <span>{{ color | title }}</span>
                </label>
                {% endfor %}
            </div>
        </div>

        <button class="reset-filters" onclick="resetFilters()">Сбросить фильтры</button>
    </div>

    <div class="content-area">
        <h2>{% if current_category %}Товары категории{% else %}Все товары{% endif %}</h2>

        {% if categories_products and has_products %}
            {% for category_name, category_data in categories_products.items() %}
                <div class="category" data-category-id="{{ category_data.id }}">
                    {% if not current_category %}
                        <h3>{{ category_name | title }}</h3>
                    {% endif %}

                    <div class="products-grid">
                        {% for product in category_data.products %}
                            {% include 'products/product_card.html' %}
                        {% endfor %}
                    </div>

                    <div class="category-actions">
                        <button onclick="loadMoreProducts('{{ category_data.id }}', this)"
                                class="view-all-btn load-more-btn"
                                data-skip="{{ category_data.current_skip }}"
                                data-category-id="{{ category_data.id }}">
                            Показать еще
                        </button>

                        <button onclick="collapseProducts('{{ category_data.id }}', this)"
                                class="view-all-btn collapse-btn"
                                style="display: none;"
                                data-category-id="{{ category_data.id }}">
                            Свернуть
                        </button>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-products-found">
                <p>Товары не найдены</p>
                <p>Попробуйте изменить параметры фильтрации</p>
                <button class="reset-filters" onclick="resetFilters()">Сбросить фильтры</button>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{% endblock %}